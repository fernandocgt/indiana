<!DOCTYPE html>
<html lang="pt-br" class="light">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <title>Fazenda Indiana - Gestão GMD</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"/>

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#bd600f",
                        "background-light": "#fcf9f7",
                        "background-dark": "#1a1410",
                    },
                    fontFamily: { "display": ["Noto Serif", "serif"] }
                },
            },
        }
    </script>

    <style>
        body { font-family: 'Noto Serif', serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input:focus { border-color: #bd600f !important; ring: 0 !important; }
        .active-tab { color: #bd600f !important; font-weight: 800; }
    </style>
</head>

<body class="bg-background-light text-slate-900 min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="h-16 bg-white border-b border-primary/20 flex items-center justify-between px-4 sticky top-0 z-50 shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-primary text-white size-9 rounded-lg flex items-center justify-center font-bold shadow-md">GT</div>
            <div>
                <h1 class="text-sm font-bold leading-none">Gestão de Pesagem</h1>
                <p class="text-[10px] text-primary font-bold uppercase tracking-widest">Análise de GMD</p>
            </div>
        </div>
        <button class="bg-primary/10 text-primary p-2 rounded-lg">
            <span class="material-symbols-outlined">qr_code_scanner</span>
        </button>
    </header>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="flex-1 overflow-y-auto no-scrollbar pb-24">
        
        <!-- CARD DE ENTRADA DE DADOS -->
        <section class="p-4">
            <div class="bg-white rounded-2xl border-2 border-primary/10 shadow-lg p-5 space-y-5">
                <div class="flex justify-between items-center border-b border-slate-50 pb-3">
                    <h3 class="font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">scale</span> Entrada de Campo
                    </h3>
                    <span class="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">ID: 4052</span>
                </div>

                <div class="space-y-4">
                    <!-- ID Animal -->
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Brinco / ID Animal</label>
                        <input id="animal_id" type="text" placeholder="Ex: 4052" class="w-full bg-slate-50 border-slate-200 rounded-xl p-4 text-xl font-bold">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Peso Ant. (kg)</label>
                            <input id="peso_anterior" type="number" value="425.50" disabled class="w-full bg-slate-100 border-none rounded-xl p-3 font-bold text-slate-400">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Peso Atual (kg)</label>
                            <input id="peso_atual" type="number" step="0.01" placeholder="0.00" class="w-full bg-slate-50 border-primary/30 rounded-xl p-3 font-black text-primary text-lg">
                        </div>
                    </div>

                    <!-- Resultado GMD em Tempo Real -->
                    <div class="bg-primary/5 rounded-xl p-4 border border-primary/10 flex items-center justify-between">
                        <div>
                            <p class="text-[10px] font-bold text-primary uppercase">GMD Calculado</p>
                            <p class="text-3xl font-black text-slate-800">1.28 <span class="text-xs font-normal">kg/dia</span></p>
                        </div>
                        <div class="bg-primary text-white size-10 rounded-full flex items-center justify-center">
                            <span class="material-symbols-outlined">trending_up</span>
                        </div>
                    </div>

                    <button id="btn_salvar_pesagem" class="w-full h-16 bg-primary text-white rounded-xl font-black text-lg shadow-xl shadow-primary/20 flex items-center justify-center gap-3 active:scale-95 transition-all">
                        SALVAR PESAGEM
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- RESUMO DA SESSÃO -->
        <section class="px-4 mt-2 space-y-4">
            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest px-1">Sessão de Hoje</h4>
            
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm">
                    <p class="text-[9px] font-bold text-slate-400 uppercase">Animais Pesados</p>
                    <p class="text-xl font-black text-slate-800">42 <span class="text-xs text-slate-300">/ 120</span></p>
                    <div class="w-full bg-slate-100 h-1.5 rounded-full mt-2">
                        <div class="bg-primary h-full rounded-full" style="width: 35%"></div>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm">
                    <p class="text-[9px] font-bold text-slate-400 uppercase">GMD Médio Lote</p>
                    <p class="text-xl font-black text-primary">1.02 <span class="text-xs">kg</span></p>
                </div>
            </div>

            <!-- Gráfico Simples de Tendência -->
            <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm">
                <p class="text-[9px] font-bold text-slate-400 uppercase mb-4 text-center">Evolução de Peso - ID 4052</p>
                <div class="flex items-end justify-between h-24 px-2 gap-2">
                    <div class="w-full bg-primary/20 rounded-t-md" style="height: 40%"></div>
                    <div class="w-full bg-primary/40 rounded-t-md" style="height: 60%"></div>
                    <div class="w-full bg-primary/60 rounded-t-md" style="height: 75%"></div>
                    <div class="w-full bg-primary rounded-t-md" style="height: 90%"></div>
                </div>
                <div class="flex justify-between mt-2 text-[8px] font-bold text-slate-400 uppercase">
                    <span>Ago</span><span>Set</span><span>Out</span><span>Hoje</span>
                </div>
            </div>
        </section>

    </main>

    <!-- TAB BAR INFERIOR -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-primary/10 h-20 flex justify-around items-center px-2 pb-4 z-50">
        <button class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-symbols-outlined">dashboard</span>
            <span class="text-[10px] font-bold">Início</span>
        </button>
        <button class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-symbols-outlined">agriculture</span>
            <span class="text-[10px] font-bold">Manejo</span>
        </button>
        <button class="flex flex-col items-center gap-1 active-tab">
            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1">scale</span>
            <span class="text-[10px] font-bold">GMD</span>
        </button>
        <button class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-symbols-outlined">gavel</span>
            <span class="text-[10px] font-bold">Leilões</span>
        </button>
    </nav>

    <!-- SCRIPT FIREBASE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5aXTHrFD5Vw-AyeDhmj85VwN2vmlsLk4",
            authDomain: "indiana-dd5bf.firebaseapp.com",
            projectId: "indiana-dd5bf",
            storageBucket: "indiana-dd5bf.firebasestorage.app",
            appId: "1:1066097977043:web:c77f739077af6b75b1626"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function salvarPesagem() {
            const animalId = document.getElementById('animal_id').value;
            const peso = document.getElementById('peso_atual').value;
            const btn = document.getElementById('btn_salvar_pesagem');

            if (!animalId || !peso) {
                alert("Preencha o ID e o Peso Atual.");
                return;
            }

            try {
                btn.disabled = true;
                btn.innerText = "SALVANDO...";

                await addDoc(collection(db, "pesagens"), {
                    animalId: animalId,
                    peso: Number(peso),
                    dataPesagem: serverTimestamp(),
                    tipo: "Campo"
                });

                alert("Pesagem do animal " + animalId + " salva!");
                document.getElementById('animal_id').value = "";
                document.getElementById('peso_atual').value = "";
                
            } catch (e) {
                alert("Erro ao salvar: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'SALVAR PESAGEM <span class="material-symbols-outlined">arrow_forward</span>';
            }
        }

        document.getElementById('btn_salvar_pesagem').addEventListener('click', salvarPesagem);
    </script>

</body>
</html>
